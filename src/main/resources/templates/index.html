<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<title>Bootstrap Theme The Band</title>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" media="all" href="../static/style2.css" th:href="@{/style2.css}" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.3/css/swiper.min.css"/>
		<link href="https://fonts.googleapis.com/css?family=Dancing+Script%7CLato:300,400,700" rel="stylesheet"/>		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.3/js/swiper.min.js"></script>
		
	</head>
	<body id="myPage" data-spy="scroll" data-target=".navbar" data-offset="50">
	
	<!-- ############################################################### -->
	<nav class="navbar navbar-default navbar-fixed-top shadow">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span> 
				</button>
				<a class="navbar-brand" href="#" id="Shop-Name-Title1">PHILLIE’S FLOWERS</a>
			</div>
			<div class="collapse navbar-collapse" id="myNavbar">
				<ul class="nav navbar-nav navbar-right">
					<li><a th:href="@{?lang=en}">English</a></li>
					<li><a th:href="@{?lang=de}">Deutch</a></li>
					<li><a th:text="#{shop.home}" href="#myCarousel">HOME</a></li>
					<li><a th:text="#{shop.products}" href="#products">PRODUCTS</a></li>
					<li><a th:text="#{shop.about}" href="#about">ABOUT US</a></li>
					<li><a th:text="#{shop.contact}" href="#contact">CONTACT</a></li>
					<li><a th:text="#{shop.staff}" href="/admin/statistic">STAFF</a></li>
				</ul>
			</div>
		</div>
	</nav>
	

	<!-- ############################################################### -->
	
	
	
	<div id="myCarousel" class="carousel slide" data-ride="carousel">
		<!-- Indicators -->
		<ol class="carousel-indicators">
			<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
			<li data-target="#myCarousel" data-slide-to="1"></li>
		</ol>
		
		<!-- Wrapper for slides -->
		<div class="carousel-inner" role="listbox">
			<div class="item active">
				<img src="../static/stock2.png" th:src="@{/stock2.png}" alt="New York"/>
				<div class="carousel-caption">
					<h1 id = "Shop-Name-Title2">Phillie’s Flowers</h1>
					<h2 th:text="#{shop.banner1}">Looking Forward to Valentines...</h2>
					<div class="home-buttons text-center">
						<a href="#products" class="btn btn-lg  btn-primary">our products</a>
					</div>
				</div> 
			</div>
			
			<div class="item">
				<img src="../static/stock1.png" th:src="@{/stock1.png}" alt="Chicago"/>
				<div class="carousel-caption">
					<h1>Phillie’s Flowers</h1>
					<h2 th:text="#{shop.banner2}">The Winter Range Is Now In Stock.</h2>
					<div class="home-buttons text-center">
						<a href="#products" class="btn btn-lg  btn-primary">our products</a>
					</div>
				</div> 
			</div>
		</div>
		
		<!-- Left and right controls -->
		<a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
			<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
			<span class="sr-only">Previous</span>
		</a>
		<a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
			<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
			<span class="sr-only">Next</span>
		</a>
	</div>
	
	<!-- ############################################################### -->
	
	<div class="container overflow-hidden" id="products">
		<div class="row">
			<div class="col-md-12">
				<h3 class="section-heading" th:text="#{shop.header1}">Products</h3>
				<p style="text-align: center;" th:text="#{shop.warning}">All products bought in one transaction are placed into One Bouquet</p>
			</div>
			<div class="col-md-12" style="text-align: center;">
				<!-- Swiper -->
				<div class="swiper-container">
					<div class="swiper-wrapper">
						<div class="swiper-slide" th:each="item : ${items}">
							<div><a href="#1"><img th:src="${item.image}" class="img-responsive"/></a>
								<h2 class="itemName" th:text="${item.name}">NAME</h2>
								<p class="price">$<span th:text="${item.cost}" th:remove="tag">PRICE</span></p>
								<button type="button" class="btn cart_but" th:value="${item.id}" data-toggle="modal" data-target="#cart"><span class="glyphicon glyphicon-shopping-cart"></span> Add To Cart</button>
							</div>
						</div>
					</div>
					<!-- Add Pagination -->
					<div class="swiper-button-next"></div>
    				<div class="swiper-button-prev"></div>
				</div>
			</div>
			<div class="col-md-12 col-md-offset-6">
				<div class="swiper-pagination"></div>
			</div>
		</div>
	</div>

	<!-- ############################################################### -->
	
	<div id="about" class="container-fluid background-stage-1">
		<div class="row">
			<div class="col-md-6 dark text-center">
				<h3 class="section-heading">Joshua Nuttall</h3>
				<p>App-development Frameworks</p>
				<p>Software Development year 4</p>
				<p>joshua.nuttall@mycit.ie</p>
				<p>R00128796</p>
			</div>
			<div class="col-md-6"></div>
		</div>
	</div>
	
	<div class="container-fluid background-stage-2">
		<div class="row">
			<div class="col-md-6"></div>
			<div class="col-md-6 dark text-center">
				<h3 class="section-heading">Dave Coughlan</h3>
				<p>App-development Frameworks</p>
				<p>Software Development year 4</p>
				<p>david.coughlan1@mycit.ie</p>
				<p>R00009964</p>
			</div>
		</div>
	</div>
	
	<!-- ############################################################### -->	
	
	
	<!-- ############################################################### -->	
	
	<div id="contact" class="container" style="clear: both;">
		<h3 class="section-heading" th:text="#{shop.header2}">Contact</h3>
		<div class="row">
			<div class="col-md-4">
				<p th:text="#{shop.contact}">Contact information</p>
				<p><span class="glyphicon glyphicon-map-marker"></span> Cork, IRE</p>
				<p><span class="glyphicon glyphicon-phone"></span> Phone: +00 3532496897</p>
				<p><span class="glyphicon glyphicon-envelope"></span> Email: mail@mail.com</p> 
			</div>
			<div class="col-md-8">
				<input class="form-control" id="name" name="name" placeholder="Name" type="text"/>
				<input class="form-control" id="email" name="email" placeholder="Email" type="email"/>
		    	<textarea class="form-control" id="comments" name="comments" placeholder="Comment" rows="5"></textarea>
				<div class="row">
					<div class="col-md-3 form-group">
						<button class="btn pull-left" type="submit" th:text="#{shop.send}">Send Message</button>
					</div>
				</div> 
			</div>
		</div>
	</div>
	
	<!-- ############################################################### -->
	
	
	<!-- Modal -->
	<div class="modal fade" id="cart" role="dialog">
		<div class="modal-dialog">
			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" style="color: white;">&times;</button>
					<h4 class="modal-title">PHILLIE’S FLOWERS</h4>
				</div>
				<div class="modal-body" id="body-order">
					<h4 class="section-heading small">Cart</h4>
					<div id="cart-content">
					</div>
					<h4 class="section-heading small">Cost</h4>
					<div id="cost">
					</div>
					<button id="next" class="btn btn-default">Next</button>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				</div>
			</div>

		</div>
	</div>
	
	<!-- ############################################################### -->


	<script>		
		$(".cart_but").click(function () {
			var x = this;
			item_id = x.getAttribute("value");
			var send_url = "cart/1/" + item_id;
			var send_data = "{operation:'ADD', count:'1'}";
			$.ajax({
				url: send_url,
				type: 'PUT',
				dataType: 'json', 
				data: JSON.stringify({operation:'ADD', count:'1'}),
				contentType: 'application/json', 
				success: updateCart()
			});
		});
		
		$("#next").click(function () {
			addressForm();
	    });
		
		function addressForm(){
			frm = document.createElement("form");
			frm.setAttribute("id","formBuy");
			frm.setAttribute("action","/shop/order/buy/1");
			frm.setAttribute("method","post");
			var names = ["firstname", "lastname", "address", "town", "city", "post"];
			for(var name in names){
				var input = document.createElement("input");
				var label = document.createElement("label");
				var text = document.createTextNode(names[name]+":");
				label.appendChild(text);
				label.setAttribute("for", names[name]);
				input.setAttribute("type", "text");
				input.setAttribute("required", "required");
				input.setAttribute("name", names[name]);
				input.setAttribute("class", "form-control");
				input.setAttribute("id", names[name]);
				frm.appendChild(label);
				frm.appendChild(input);
			}
			
			
			var button = document.createElement("button");
			var text2 = document.createTextNode("Submit");
			button.appendChild(text2);
			button.setAttribute("type","submit");
			button.setAttribute("class","btn btn-primary");
			button.setAttribute("style","margin-top: 10px;");
			frm.appendChild(button);
			$("#body-order").html("");
			document.getElementById("body-order").appendChild(frm);
			document.getElementById("body-order").appendChild(document.createElement("hr"));
			var button2 = document.createElement("button");
			var text = document.createTextNode("Return");
			button2.setAttribute("onClick", "javascript: returnCart();");
			button2.setAttribute("class","btn btn-secondary return");
			button2.appendChild(text);
			document.getElementById("body-order").appendChild(button2);
			formListener();
		}
		
		function formListener(){
			var frm = $('#formBuy');
			frm.submit(function (e) {
		    	e.preventDefault();
		    	var result = { };
		    	var x = frm.serializeArray();
		    	$.each(x, function(i, field){
		    		result[field.name] = field.value;
		        });
		        $.ajax({
		            type: frm.attr('method'),
		            url: frm.attr('action'),
		            data: JSON.stringify(result),
		            contentType: 'application/json',
		            success: function(){
		            	returnCart();
		            	updateCart();
		            }
		        });
		    });
		}
		
		function returnCart() {
			$("#body-order").html("");
			var head1 = document.createElement("h4");
			var text1 = document.createTextNode("Cart");
			var head2 = document.createElement("h4");
			var text2 = document.createTextNode("Cost");
			var button = document.createElement("button");
			var text3 = document.createTextNode("Next");
			button.setAttribute("id", "next");
			button.appendChild(text3);
			head1.appendChild(text1);
			head2.appendChild(text2);
			var div1 = document.createElement("div");
			var div2 = document.createElement("div");
			div1.setAttribute("id", "cart-content");
			div2.setAttribute("id", "cost");
			head1.setAttribute("class", "section-heading small");
			head2.setAttribute("class", "section-heading small");
			button.setAttribute("onClick", "javascript: addressForm();");
			button.setAttribute("class", "btn btn-default");
			
			document.getElementById("body-order").appendChild(head1);
			document.getElementById("body-order").appendChild(div1);
			document.getElementById("body-order").appendChild(head2);
			document.getElementById("body-order").appendChild(div2);
			document.getElementById("body-order").appendChild(button);
			updateCart();
		}
	
		function updateCart(){
			setTimeout(function () {
				var xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function() {
					var total = 0;
					if (this.readyState == 4){
						if(this.status == 200){
							$("#cart-content").html("");
							$("#cost").html("");
							if(!this.responseText){
								return;
							}
							var items = JSON.parse(this.responseText);
							for (var key in items) {
								if (items.hasOwnProperty(key)) {
									for(var key2 in items[key]){
										if (items[key].hasOwnProperty(key2)) {
											var val = items[key][key2];
											total+= (val["item"]["cost"] * val["count"]);
											var div = document.createElement("div");
											var card =  document.createElement("div");
											var break_div = document.createElement("div");
											var title = document.createElement("p");
											var inner_body1 = document.createElement("h4");
											var t1 = document.createTextNode("Amount: " + val["count"] + "   Cost: $" + (val["item"]["cost"] * val["count"]));   
											var t2 = document.createTextNode(val["item"]["name"]);
											div.setAttribute("class", "card bg-darken-2" );
											div.setAttribute("style", "margin-left: 25%; width: 50%;");
											card.setAttribute("class", "card-body" );
											break_div.setAttribute("class", "card-break bg-lighten-2");
											title.setAttribute("class", "card-title");
											title.appendChild(t2);
											inner_body1.setAttribute("class", "card-text");
											inner_body1.appendChild(t1);
											div.appendChild(card);
											div.appendChild(title);
											div.appendChild(break_div);
											div.appendChild(inner_body1);
											//var td4 = document.createElement("td");
											//var button = document.createElement("button");
											//var t4 = document.createTextNode("Remove");   
											//button.setAttribute( "onClick", "javascript: removeFunc("+val["item"]["id"]+");" );
											//button.appendChild(t4);
											//td4.appendChild(button);
											document.getElementById("cart-content").appendChild(div);
											document.getElementById("cart-content").setAttribute("style", "text-align: center;");
										}
									}
								}
							}
							var cost = document.createElement("p");
							var cost_ammount = document.createTextNode("$"+total);
							cost.setAttribute("style", "text-align: center;");
							cost.appendChild(cost_ammount);
							document.getElementById("cost").appendChild(cost);
						}
					}
				};
				xhttp.open("GET", "/shop/cart/1", true);
				xhttp.send();
			}, 1000);
			
		}
	
		var swiper = new Swiper('.swiper-container', {
			slidesPerView: 3,
			spaceBetween: 30,
			pagination: {
				el: '.swiper-pagination',
				clickable: true,
			},
			navigation: {
				nextEl: '.swiper-button-next',
				prevEl: '.swiper-button-prev',
			},
		}); 
		
		// Instantiate the Bootstrap carousel../static/carousel.js
		$('.multi-item-carousel').carousel({
		  	interval: false
		});
	
		// for every slide in carousel, copy the next slide's item in the slide.
		// Do the same for the next, next item.
		$('.multi-item-carousel .item').each(function(){
			var next = $(this).next();
			if (!next.length) {
			  	next = $(this).siblings(':first');
			}
			next.children(':first-child').clone().appendTo($(this));
			
			if (next.next().length>0) {
			  	next.next().children(':first-child').clone().appendTo($(this));
			} else {
				$(this).siblings(':first').children(':first-child').clone().appendTo($(this));
			}
		});
		
		function updateName(){
	    	var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4){
					if(this.status == 200){
						var name = this.responseText;
						var el = document.getElementById("Shop-Name-Title1");
						var el2 = document.getElementById("Shop-Name-Title2");
						var text2 = document.createTextNode(name);
						var text1 = document.createTextNode(name);
						el.innerHTML = "";
						el.appendChild(text1);
						el2.innerHTML = "";
						el2.appendChild(text2);
					}
				}
			};
			xhttp.open("GET", "/admin/shop/getName", true);
			xhttp.send();
	    }
		
		
	    
	   	updateName();
	   	updateCart();
	</script>

</body>
</html>